# Overview

클러스터는 최대 몇개의 인덱스를 생성할 수 있을까? 하나의 샤드 크기는 얼마가 적당할까? 이런 질문은 엘라스틱서치를 운영하는 사람들에게는 한번쯤 고민해봤을 질문이다. 

시간이 흐를수록 관리되는 데이터는 점점 커진다. 현재 서비스가 원할히 된다고 해서 앞으로 서비스가 잘 될거란 보장은 없다. 분산 시스템의 경우 이론상 데이터가 무한히 증가할 수 있기 때문에 최적화의 필요성이 더욱 더 커진다. 

분산 검색 시스템인 엘라스틱서치를 운영한다는 것은 항상 최적화를 고민해야 한다는 것과 같다. 이번 장에서는 운영하면서 한번쯤 고민해야할 사항을 알아보겠다.

# 운영 중 샤드 개수 수정이 불가한 이유

클러스터에서 운영 중인 인덱스는 원칙적으로 수정이 불가능하다. 인덱스를 생성할때 한번 설정된 샤드의 개수는 절대 변경이 불가능하기 때문에 데이터의 크기가 최대 얼마까지 증가할 것인지 잘 계산해서 최초 인덱스 생성시 샤드의 개수를 신중하게 결정해야 한다. 

샤드에는 두 종류가 존재한다. 첫번째는 실제 서비스가 일어나느 프라이머리 샤드이다. 실질적인 CRUD를 제공하는 샤드로 엘라스틱서치에서 핵심요소이다. 이 프라이머리 샤드를 일반적으로 샤드로 부른다. 두번째는 레플리카 샤드다. 기본적으로 장애 복구를 위해 존재한다. 하지만 프라이머리 샤드와 동일한 데이터를 가지고 있기 때문에 평상시에는 읽기 분산에도 활용된다. 

엘라스틱서치에서는 최초 인덱스를 생성할때 settings 속성을 이용해 샤드와 레플리카 개수를 각각 정의할 수 있다. 

number_of_shards
: 샤드의 개수(number_of_shards)는 전체 데이터를 몇개의 샤드로 나누어 보관할지를 의미한다. 이 값으로 프라이머리 샤드의 개수가 결정된다.

number_of_replicas

: 레플리카 개수(number_of_replicas)는 몇개의 복사본 세트를 만들것인지를 의미한다. 이 속성 값으로 레플리카 샤드의 개수가 결정된다.


한 임의의 인덱스를 생성할때 만약 5개의 샤드와 1개의 레플리카 세트를 만든다고 했고 시간이 흘러 인덱스에 총 1억건의 데이터가 색인 됐다고 가정해보자. 5개의 프라이머리 샤드를 설정했기 때문에 각 샤드는 2천건의 데이터를 가져가게 될것이다. 

이런 상황에서 검색 성능을 향상 시키기 위해 물리적인 장비를 추가 투입해서 샤드 5개를 추가하기로 했다고 하자. 

> Written with [StackEdit](https://stackedit.io/).
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTEzMDk4Mjc0ODEsLTMxOTE1MDgxNV19
-->