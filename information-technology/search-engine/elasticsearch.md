# Overview

구글이나 네이버에서 제공하는 다양한 서비스는 빼놓을 수 없는 포털 사이트 서비스이다. 이 검색 서비를 부르는 용어도 다양한데, 검색 엔진, 검색 시스템, 검색 서비스 등의 용어가 대표적이다. 

대다수의 독자는 위 세 가지 용어가 비슷하다고 생각할 것이다. 하지만 세 가지 용어는 명백히 다르다. 

검색 엔진(search engine)
: 광활한 웹에서 정보를 수집해 검색 결과를 제공하는 프로그램이다.

검색 시스템(search system)
: 대용량 데이터를 기반으로 신뢰성 있는 검색 결과를 제공하기 위해 검색 엔진을 기반으로 구축된 시스템을 통칭하는 용어이다. 

검색 서비스(search service)
: 검색엔진을 기반으로 구축한 검색 시스템을 활용해 검색 결과를 서비스로 제공한다. 

## 검색 시스템의 구성요소

수집기(collector)
: 수집기는 웹 사이트, 블로그, 카페 등 웹에서 필요로 하는 정보를 수집하는 프로그램이다. 크롤러(crawler), 스파이더(spider), 웜(worms)등으로 불린다. 파일, 데이터베이스, 웹페이지 등 웹상의 대부분의 정보가 수집 대상이다. 

스토리지(storage)
: 데이터베이스에 데이터를 저장하는 물리적 저장소다. 검색 엔진은 색인한 데이터를 스토리지에 보관한다.

색인기(Indexer)
: 검색엔진이 수집한 정보에서 사용자의 질의와 일치하는 정보를 찾으려면 수집된 데이터를 검색가능한 구조로 가공하여 저장해야 한다. 이 역할을 하는 것이 색인기이다. 색인기는 다양한 형태소 분석기를 조합해 정보에서 의미가 있는 용어를 추출하고 검색에 유리한 역색인 구조로 데이터를 저장한다. 

검색기(searhcer)
: 사용자의 질의를 입력받아 색인기에서 저장한 역색인 구조에서 일치하는 문서를 찾아 반환한다. 질의와 문서가 일치하는 지를 유사도 기반의 검색 순위 알고리즘으로 판단한다. 검색기 또한 색인기와 마찬가지로 형태소 분석기를 이용해 사용자 질의에서 유의미한 용어를 추출해 검색한다. 따라서 사용하는 형태소 분석기에 따라 검색 품질이 달라진다. 

## 관계형 데이터베이스와 차이점

검색 엔진을 설명할때 항상 비교되는 것이 관계형 데이터베이스(RDBMS)이다. 두 가지 모두 질의와 일치하는 데이터를 찾아 사용자에게 제공한다는 점에서 유사점이 많다. 하지만 관계형 데이터 베이스만의 검색 기능으로는 한계가 있다.

RDBMS에서는 모든 데이터는 중복을 제거하고 정형의 데이터로 구조화해서 행과 열로 구성된 테이블로 저장된다. SQL문을 이용한 정보 검색은 텍스트 매칭을 통한 단순한 검색만이 가능하다. 텍스트를 여러 단어로 변형하거나 여러 개의 동의어나 유의어를 활용한 검색을 불가능하다. 

반면에 검색엔진은 데이터베이스에서는 불가능한 비정형 데이터를 색인하고 검색할 수 있다. 형태소 분석을 통해 사람이 구사하는 자연어의 처리가 가능해지고 역색인 구조를 바탕으로 빠른 검색 속도를 보장한다. 

| 엘라스틱서치| 관계형 데이터베이스|
|--|--|
|인덱스(Index)  |  데이터베이스(Database)|
|샤드(Shard)  |  파티션(Partition)|
|타입(Type)  |  테이블(Table)|
|문서(Document)|  행(Row)|
|필드(Field)| 열(Col)|
|매핑(Mapping)| 스키마(Schema)|
|Query DSL| SQL|

위 차트는 엘라스틱 서치와 관계형 데이터베이스의 주요 개념을 배교해서 보여준다. 엘라스틱 서치에서 타입은 테이블과 같은 역할을 한다. 
하나의 행을 문서라고 부르며, 해당 문서는 데이터베이스의 테이블에서 한 행을 말한다. 

## 검색 시스템과 엘라스틱서치

대량의 데이터를 빠르게 검색하기 위해 고안된 NoSQL(No Structured Query Language)를 많이 사용한다. 엘라스틱 서치도 NoSQL의 일종으로 분산 처리를 통해 실시간에 준하는 빠른 검색이 가능하다. 기존 데이터 베이스에서는 처리하기 어려운 비정형의 데이터도 검색할 수 있으며, 전문 검색과 구조 검색 모두를 지원한다. 기본적으로 검색 엔진이지만 MongoDB나 Hbase처럼 대용량 스토리지로도 활용할 수 있다. 

엘라스틱 서치의 장점은 아래와 같다.

* 오프소스 검색엔진
	* 아파치 재단의 루씬(Lucene)을 기반으로 개발된 오픈소스 검색엔진이다. 
* 전문 검색
	* 단순 텍스트 검색 기능뿐만 아니라 좀 더 고차원적인 전문 검색이 가능하다. 전문 검색이란 내용 전체를 색인해서 특정 단어가 포함된 문서를 검색하는 것을 말한다. 
* 통계 분석
	* 비정형 로그 데이터를 수집하고 한곳에 모아 통계 분석한다. 엘라스틱 서치와 키바나(Kibana)를 연결하면 실시간으로 쌓이는 로그를 시각화하고 분석할 수 있다.
* Document-Oriented
	* 여러 계층의 데이터를 JSON형식의 구조화된 문서로 인덱스에 저장할 수 있다. 계층 구조로 문서도 한번의 쿼리로 조회할 수 있다.
* 역색인(Inverted Index)
	* 엘라스틱 서치는 루씬 기반의 검색엔진이다. 따라서 엘라스틱서치 또한 역색인을 지원한다. 바면 MongoDB나 카산트라(Casandra)같은 일반적인 NoSQL은 역색인을 지원하지 않는다. 이는 다른 NoSQL 대비 엘라스틱서치의 매우 큰 장점이다. 

엘라스틱 서치의 단점은 아래와 같다.

* 실시간이 아니다. 일반적으로 색인된 데이터는 통상적으로 1초 뒤에나 검색이 가능하다. 색인된 데이터는 내부적으로 커밋과 플러시 같은 복잡한 과정을 거치기 때문에 실시간이 아니다. 엄밀히 말하면 실시간(Near Realtime)이라 할 수 있다.
* 트랜잭션과 롤백 기능을 제공하지 않는다. 엘라스틱 서치는 기본적으로 분산 시스템으로 구성된다. 전체적인 클러스터의 성능을 위해 비용 소모가 큰 롤백(Rollback)과 트랜잭션을 지원하지 않기 때문에 최악의 경우 데이터 손실의 위험이 있다. 
* 데이터의 업데이트를 제공하지 않는다. 엄밀히 말하면 업데이트 명령이 요청될 경우 기존 문서를 삭제하고 새로운 내용으로 문서를 생성하는 방식을 사용한다. 따라서 단순 업데이트에 비해서는 많은 비용이 발생한다. 

## 키바나(Kibana)

키바나는 엘라스틱에서 제공하는 데이터 시각화 프로그램이다. 당장은 시각화 기능이 필요하진 않지만 키바나를 이용하면 색인된 데이터를 검색하거나 문서를 추가하거나 삭제하는 등의 기능을 손쉽게 구현할 수 있다. 사실 키바나에서 제공하는 UI가 매우 유용하다. 

# 엘라스틱 서치 코어

엘라스틱 서치가 기본적으로 분산 시스템을 지향하다보니 생소한 용어가 많다. 용어가 무엇인지 잘 파악하면 전체 아키텍처를 이해하는데 많은 도움이 된다. 엘라스틱 서치를 구성하는 주요 구성요소로 어떤 것이 있는지 알아보자.

## 





> Written with [StackEdit](https://stackedit.io/).
<!--stackedit_data:
eyJoaXN0b3J5IjpbMTYxMzM2MzI5MywtNjA0NDM1OTYxLC00MT
YyNTExNDMsLTE0NjM1MTc5NSwxMzgzOTM1NTIzLDg5Mzc5Mjgy
XX0=
-->