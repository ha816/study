# Overview

이번 장에서는 엘라스틱서치의 시스템적 측면을 공부해보자. 그리고 이를 통해 엘라스틱서치 클러스터가 안정적으로 동작하는데 필요한 시스템 구성을 함께 고민해보자. 

# 노드 실행환경과 JVM 옵션

엘라스틱서치와 루씬은 모두 자바 언어로 개발되었다. 하지만 독립적으로 실행 가능한 엘라스틱 서치와는 달리 루씬은 독립적으로 실행될 수 없는 라이브러리 형태로 제공된다. 루씬은 자바 애플리케이션에서 사용할 수 있도록 jar형태로 배포되고, 엘라스틱서치는 이러한 jar 라이브러리를 임포트하는 방식으로 활용한다. 엘라스틱서치가 실행되어 인스턴스가 만들어지면 엘라스틱서치와 루씬 둘 다 하나의 JVM에서 함께 동작한다. 이제 엘라스틱서치 인스턴스가 실행되는 실행환경에 대해 알아보자. 

## 엘라스틱서치 릴리즈 노트

2010년 즈음 오픈 소스로 개발되기 시작해서 2014년 1.0 버전이 공식 출시된 이후로 지금도 매우 빠르게 성장하고 있다. 

실무에서는 2.x ~ 5.x 버전이 아직 많이 사용되고 있다. 하지만 새롭게 엘라스틱 서치를 도입한다면 6.x 이상을 사용할 것을 권장한다. 최신 버전을 사용함으로써 자바와 루씬의 최신 기능을 모두 사용할 수 있기 때문이다. 

엘라스틱서치와 루씬은 매우 밀접한 관계가 있다. 엘라스틱서치는 루씬을 기반으로 동작하기 때문에 엘라스틱버전에 따라 내부에서 사용하는 루씬 버전도 함께 달라진다. 루씬 라이브러리의 기능이 추가되거나 버그가 수정되면 주기적으로 버전업하게 되는데, 엘라스틱서치에서도 새롭게 버전업된 루씬을 기반으로 새로운 버전의 엘라스틱서치를 릴리스해서 제공한다. 

엘라스틱서치와 루씬 모두 오픈소스이고 엘라스틱서치의 개발자가 동시에 루씬의 개발자이기도 하다. 그래서 루씬의 기능이 새로 추가 될때마다 엘라스틱서치도 그에 따라 새로운 기능으로 릴리스가 된다. 

## 실행시 자바 8 이상을 사용해야할 이유

최근 급견한 하드웨어 기술의 발달로 CPU나 메모리 자원이 매우 저렴해졌다. 한 서버에서 다수의 CPU나 코어를 탑재하고 메모리도 비교적 넉넉하다. 

### 다수의 CPU 사용

64비트 컴퓨터로 변경되면서 메모리 사용은 사실 프로그래밍 관점에서는 크게 변화가 없었다. 하지만 다수의 CPU를 사용하는 프로그래밍에서는 변화가 컸다. 기존 멀티쓰레드 기반 프로그래밍은 하나의 CPU를 효율적으로 사용하기 위한 방식이 대부분이었기 때문에 오히려 CPU가 많은 환경에서는 비효율적인 경우가 종종 발생했다.

다수의 CPU가 탑재된 경우 동시에 모든 CPU를 점유해서 동작하여 프로그래밍을 해야 했는데 이런 방식은 멀티 쓰레드 방식 방식과 비교했을때 상대적으로 매우 어려운 일이었다. 

자바는 8 버전 부터 큰 변화가 생겼다. 그 중 대표적으로는 함수형 프로그래밍의 도입이라고 할 수 있다. 함수형 프로그래밍 언어 지원을 위해 스트림과 람다 표현식이 지원되기 시작했다. 

스트림을 사용하면 언어차원에서 손쉽게 멀티 코어로 함수를 동작시킬수 있다. 이런 특수한 함수를 람다라고 부르는데 람다를 이용해 로직을 작성하고 스트림에 입력하면 다수의 CPU에서 동시에 데이터가 처리되고 모든 CPU에 처리가 끝날때 까지 결과를 기다리게 된다. 이후 모든 결과를 모아 돌려준다. 즉 일종의 맵 리듀스로 동작하게 되는것이다. 

이런 과정은 언어 차원에서는 블랙박스로 이루어진다. 멀티 코어에 대해 깊은 지식이 없더라도 개발자는 로직에만 집중하면 되는 것이다. 람다를 쓸수 있는 것만으로도 자바 8을 써야하는 이유는 분명하다. 

### 항상 최신 버전의 엘라스틱서치를 사용하기

일반적으로 버전업이 이뤄질 경우 최대한 하위 호환을 고려해서 개발이 이뤄지지만 하위 호완성을 100%유지한다는 것은 매우 어려운 일이다. 


# 힙 크기를 32GB 이하로 유지하는 이유

# 엘라스틱서치와 가상 메모리

# 분산환경에서의 메모리 스와핑

# 시스템 튜닝 포인트




> Written with [StackEdit](https://stackedit.io/).
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTEzOTM3OTQ1OTQsLTE2NjIwNTE3MTEsND
QwNTMxMDk0LC0xOTYzOTMxNTMzXX0=
-->