# 통찰의 왕이 되는 분석방법들 - 다중회귀분석과 로지스틱 회귀 분석

## 통계학의 왕도 회귀분석

앞서 1편에서는 아웃컴이 양적인 이든 질적이든 그룹 간 우연이라고 말하기 어려우 수준의 차이가 있는지 없는지 따져보았다. 

아웃컴과 설명변수 사이에 인관관계를 통찰하는 것이 큰 틀이라고 했는데 이 말은 원인에 의해 아웃컴이 좌우되는 것은 아닌가 하는 것은 질적 설명변수ㅡㄹ 생각한다는 것과 같은 듯이다. 

설명 변수와 아웃컴이 모두 질적인 경우 Z검정이나 카이제곱검정으로 아웃컴의 비율을 비교한다.  그렇다면 설명변수가 양적인 경우 어떤 분석이 좋을까? 

설명변수와 아웃컴에 의한 분석방법 정리

||  질적(범주형)|양적(연속형)| 
|--|--|--|
|질적(범주형)| 비율 차이를 Z검정 또는 카이제곱검정  | 회귀분석?|
|양적(연속형)| 평균값 차이를 Z검정 또는 T검정 | 회귀분석? |

## 산포도와 회귀직선으로 경향을 파악한다. 

가로 세로촉에 양적 항목을 잡고 점을 그려넣은 그래프를 전문용어로 산포도라고 한다. 산포도를 보면 두 양적 항목에 대해서 경향성을 볼 수 있다. 그러면 어떻게 해야 객관적으로 경향성을 표현할 수 있을가? 

앞서 불규칙성이나 오차를 포함하는 데이터에서 벗어난 정도의 제곱의 합을 최소화하는 데이터를 참값으로 보는것이 옳다고 했다. 마찬가지로 경향성을 나타내는 직선과 실제 데이터 값과의 차이를 최소화 하는 직선이야 말로 가장 타당한 경향성이라고 볼 수 있다. 

통계의 힘 1편에서 제시된 적이 있는데, 부모의 키가 크면 자녀도 키가 크겠지만 부모의 평균 키만큼 크지는 않다. 반대로 부모의 키가 작으면 자녀의 키도 작겠지만 부모의 평균키 만큼 작지도 않다.  이러한 경향성을 평범으로 회귀라고 부른다. 
회귀분석이라는 이름은 평균값으로 회귀가 일어나는 현상에 대한 분석방법이라는 뜻이다. 

## 회귀분석으로 잘 보이지 않는 관계성 분석이 가능하다. 

최소제곱법을 이용하여 얻은 2개의 양적 항몬간의 경향성을 나타내는 직선을 회귀직선이라고 부르며 이를 실제 구했던 사람은 피어슨이다. 
사실 최소제곱법 계산 자체는 100년 전인 카우스에 의해 발견되었지만, 그보다 훨씬 단순한 회귀분석을 사람들은 발명이라고 할가?

회귀분석에서 가장 큰 차이점은 잘 보이지 않는 관계성을 분석할 수 있다는 점이다. 피어슨은 최소제곱법을 어떤 변수로도 나타낼 수 있는 산포도라는 추상적인 것으로 확장하여, 그 어떤 정보도 일단 수치화하면 관련성을 명백히 할 수 있는 통계학의 만능성을 가진다.

자 그러면 실제 회귀식은 어떻게 구할까?
단순한 예로 A,B,C 3명의 영업직원에게 이달의 고객 방문회수와 성사 계약건수를 물었다. 이 데이터로 계약 건수를 아웃컴으로 경향성을 해석하고 방문 1건을 늘릴때마다 평균 몇건의 계약 성사가 기대가 되는지 알고 싶다. 

설명변수인 방문회수를 가로축, 아웃컴인 계약건수를 Y축에 두고 산포도를 그리면 경향성을 해석할 수 있다. 

$$Y = aX+ b$$

$a$는 X값이 1 늘어날때마다 Y값이 얼마나 늘어나고 줄어드는지 나타내는 기울기이다. 이 기울기를 회귀계수라고도 부른다. $b$는 X가 0일때 Y값이 뭔지 나타내는 절편이다. 

최소제곱법을 사용하여 회귀직선을 구할때는 산포도에 각 점에 대해서 실제의 아웃컴값과 예측 휘귀식에서 구해지는 예측값 차이의 제곱합을 최소화 한다. 
이때 아웃컴과 예측값의 차이를 전문용어로 잔차제곱합이라고 하며, 이 값이 가장 작을때 최량의 회귀직선으로 생각한다. 

우리는 이 최량의 회귀직선을 찾는 것이 목표이다. 최량을 만드는 a,b의 조합은 무엇인가를 생각하는것이 곧 회귀분석 결과다. 

[보충 13 단순회귀분석]

||  방문횟수| 성사된 계약건수| 
|--|--|--|
|A|0회| 0건|
|B|2회| 3건|
|C|4회| 3건|

잔차제곱합은 아래로 나타나고 우리는 이것을 최소화 하는 a, b를 알고 싶다. 
$$잔차제곱합 = ∑_{i=1}^{n}(y-(ax+b))^2$$

$x_i, y_i$라는 $n$그룹의 데이터에 대해 회귀직선 $y=ax+b$의 적용을 생각 했을때, 잔차제곱합(residual sum of squares)은 a,b 값에 의해 좌우되는 함수로 생각 할 수 있으므로 이를 아래와 같이 표현할 수 있다. 

$$R(a, b) = ∑_{i=1}^{n}(y_i-ax_i-b)^2$$
이를 최소화하는 a,b의 조합을 생각할땐 a, b로 각 미분하면 된다. 

>b 미분
$$-2∑_{i=1}^{n}(y_i-ax_i-b) = 0 <=>∑_{i=1}^{n}y_i =  a∑_{i=1}^{n}x_i+nb$$

여기서 $n$으로 양변은 나누면, $\bar y = a\bar x + b$이다. 즉 회귀직선이 x와 y 각각의 평균값을 지니는 것이다.


>a 미분  
>$$-2∑_{i=1}^{n}(y_i-ax_i-b)x_i = 0 <=>∑_{i=1}^{n}x_iy_i =  a∑_{i=1}^{n}x_i^2+b∑_{i=1}^{n}x_i$$


b로 미분하는 과정에서 나온 식으로 $\bar y = a\bar x + b$ b를 소거하자. 그러면 아래와 같은 식이 구해진다. 

$$∑_{i=1}^{n}x_iy_i= a∑_{i=1}^{n}x_i^2+b∑_{i=1}^{n}x_i = a∑_{i=1}^{n}x_i^2+(\bar y-a\bar 
x)∑_{i=1}^{n}x_i$$
$$= a∑_{i=1}^{n}x_i^2+(\bar y-a\bar x){n}\bar x = a∑_{i=1}^{n}x_i^2+(\bar y-a\bar x){n}\bar x$$

$$= a∑_{i=1}^{n}x_i^2+{n}\bar x\bar y- an\bar x^2 = a(∑_{i=1}^{n}x_i^2-n\bar x^2) + n\bar x \bar y$$

따라서, $$a = (∑_{i=1}^{n}x_iy_i-n \bar x \bar y) / (∑_{i=1}^{n}x_i^2 - n \bar x^2)$$
여기서 우변 제 2항에 대해 생각해보면 사실은, 

$$∑_{i=1}^{n}x_i^2 - n \bar x^2 = ∑_{i=1}^{n}(x_i - \bar x)^2 =  ∑_{i=1}^{n}(x_i^2 - 2 \bar xx_i+ \bar x^2) $$
$$=  ∑_{i=1}^{n}x_i^2 -2\bar x ∑_{i=1}^{n}x_i + n \bar x^2 =  ∑_{i=1}^{n}x_i^2 - 2\bar x n \bar x + n \bar x^2 = ∑_{i=1}^{n}x_i^2 - n \bar x^2$$ 
 
가 되어서 n이나 n-1로 나누면 분산이 구해지는데, x의 평균값에서 벗어난 값의 제곱합이다. 

또 우변 제 1항에 대해서는, 

$$∑_{i=1}^{n}(x_i-\bar x)(y_i - \bar y) = ∑_{i=1}^{n}x_iy_i - \bar y n \bar x - \bar xn\bar y + n\bar x \bar y  = ∑_{i=1}^{n}x_iy_i-n \bar x \bar y$$
이다. x의 평균값에서 벗어난 값 *y의 평균값에서 벗어난 값을 의미한다. 이것을 n으로 나누는 것은 아무 언급도 없었지만 x와 y가 서로 독립적이라면 당연히 0이 된다. 이 값은 상홍 관련성의 기준이 되는 공분산이라고 불리는 지표다. 
 각 그룹의 x, y를 곱한값의 합 등의 값을 각각 구하면, 기울기 a가 구해진다. 이 말은 공분산을 분산으로 나눈다는 의미이다. 
 이제는 절편   $\bar y = a\bar x + b$  식으로부터 기울기의 직선이 x와 y의 평균값을 지나도록 구하면 된다. 
그러면 회귀계수의 표준오차는 어떻게 구할까?

$$a = (∑_{i=1}^{n}x_iy_i-n \bar x \bar y) / (∑_{i=1}^{n}x_i^2 - n \bar x^2)$$

위의 식의 제 2항을, x의 평균에서 벗어난 값의 제곱합(Sum of Squares)인 $S_x$라고 표현하면,

$$a = \frac{1}{S_x} (∑_{i=1}^{n}x_iy_i-n \bar x \bar y) = \frac{1}{S_x} ∑_{i=1}^{n}(x_i-\bar x)y_i - \frac{\bar y}{S_x}∑_{i=1}^{n}(x_i-\bar x)$$

$$= \frac{1}{S_x} ∑_{i=1}^{n}(x_i - \bar x)y_i - \frac{\bar y}{S_x}(n\bar x-n\bar x) = \frac{1}{S_x}∑_{i=1}^{n}(x_i- \bar x)y_i$$ 이다. 

지금까지 다뤄왔던 기와기왈 절편은 어디까지나 산출된 값이지만 참값을 각각 
α, β 또 i번째 데이터에 대응하는 잔차를 $ε_i$라고 두고 식으로 표현해보자. 
통계학에서는 오차나 잔차에 관한 것은 흔히 error의 머리글자인 e나 거기에 대응하는 그리스 문자 입실론 $ε_i$으로 표현한다. 
그렇다면 $$y_i = αx_i + β+ε_i$$ 의 관계가 모든 i에 대해 성립한다. 좀 더 엄밀하게 말하면, 회귀분석에서의 오차항 입실론은 몇 개인가의 가정을 하고 오차의 기댓값은 0, x나 y의 값과 오차는 독립적, 오차항은 정규분포를 따른다는 상황을 생각한다. 

$$y_i = αx_i + β+ε_i$$ 
이것을  $$a = \frac{1}{S_x}∑_{i=1}^{n}(x_i- \bar x)y_i$$

 --- 
 $$-2∑_{i=1}^{n}(y_i-ax_i-b)x_i = 0<=>∑_{i=1}^{n}x_iy_i = -n bar x bar y $$

$$C = ∑_{i=1}^{n}(\frac{x_i-μ}{σ})^2$$$C$는 자유도 $n$의 카이제곱($χ^2$)분포를 따른다. $σ^2$는 진정한 분산을 나타낸다.

대학에서 배운 편미분을 이용하여 a,b가 얼마일때 잔차제곱합이 최소가 되는지 알 수 있다. 

## 회귀분석에서는 기울기의 표준오차를 생각한다. 

데이터가 극단적으로 적을땐, 데이터가 우연히 발생한 상황일수도 있기 때문에 경향성을 못 믿겠다고 생각 할 수 있다. 
Z검정이나 T검정에서는 평균값 차이의 표준오차를 생각했지만, 회귀 분석에서는 회귀계수의 표준오차(SE)를 생각한다. 

평균, 비율과 마찬가지로 회귀계수에서도 원시 데이터가 그 무엇이든 모두 더하면 정규분포에 가까워 진다는 중심극한 정리가 작용한다. 수백에서 수천건 이상의 데이터로 회귀분석을 수행하면 100회 정도의 데이터 수집과 분석을 통해 산출되는 회귀 계수의 95회 정도는 진정한 회귀계수 +2SE범위에 수용된다. 데이터 수가 수백건 이라하면 회귀계수에 대해서도 평균값의 차이와 마찬가지로 정규분포보다 T분포를 사용하는 편이 편하다는 점도 완전히 동일하다. 

그러면 어디에서 차이가 있을까?

Z검정에서는 평균값에서 벗어난 값을 제곱하여 계산했다. 이 벗어난 편차의 제곱합을 전문용어로 편차제곱함이라 하는데 이것을 데이터 수로 나눈것이 붓나이다. 

회귀계수의 표준오차는 예측값과 실제 값의 차이를 제곱합을 데이터의 수로 나눈 것인 잔차제곱합을 사용한다. 잔차 제곱합을 데이터의 수롤 나눈 것을 평균제곱잔차라고 한다. 제곱한 차이의 평균값이라는 의미로 평균제곱오차라고도 한다. 

## 회귀분석 오차의 계산에 추가로 필요로 한것

추가로 하나 고려해야 할 사항은 그룹 간 평균 값을 비교할때는 필요가 없었던 설명변수의 불규칙성 크기이다. 

회귀 계수의 표준오차 크리를 생각할 경우, 아웃컴의 예측값과 실제 값이 평균적으로 어느정도 벗어나 있는가라는 크기를, 설명변수가 어느정도 불규칙한지 크기에 대한 비율로 상대적인 판단을 할 필요가 있는 것이다. 

수백에서 수천건 이상의 데이터가 있을때 회귀 계수의 표준오차는 아래와 같다. [보충 13]
$$회귀계수의 표준오차 = \sqrt{\frac{잔차제곱합}{설명변수의 편차제곱합*데이터 수}}$$


# 데이터의 배후를 파악한다 - 인자분석과 군집분석
# 통계 분석방법의 총정리와 사용순서



> Written with [StackEdit](https://stackedit.io/).
<!--stackedit_data:
eyJoaXN0b3J5IjpbOTYyMTI2ODU0LDY0OTMxODYyOCwxMzcyNz
A5MDAsMTY2MDI1ODU3LDE1OTUwNzUzODMsLTEyMTYwMTk2NzYs
MTY0MzQyMzc2LC05ODk2MzIwMTgsNTI1ODIyMzA1LC0zMDc3MD
c3OTEsMTk1MTA4MTQ1Myw2NjMzMDcyMjgsLTE5ODc0NjE2NSwx
Njk5NjU4MDYxLC03NTUwMDgyMDEsNjMyMjc0Mzk0LDQ2NzExMD
k5MiwxODQ4NTE1MTQ2LDEzMDc2NTE5MjUsLTM0NDUxOTc3Ml19

-->