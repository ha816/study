# Spring Data

이번 장에서는 Spring Data(스프링 데이터) 모듈을 사용해 리액티브 방식으로 데이터에 엑세스하는 방법을 알아봅시다. 

**스프링 데이터 모듈은 응답성이 뛰어난 리액티브 응용 프로그램을 개발하는데 필수적 입니다.** 

선택한 데이터베이스가 리액티브 또는 비동기 드라이버를 제공하지 않는다 하더라도 전용 스레드 풀을 사용해 리액티브 응용 프로그램을 구축하는 방법을 알아봅시다. 블로킹 방식의 데이터 베이스에 대해서도 리액티브 접근법을 사용할 수 있지만, 블로킹 방식의 I/O는 리액티브 응용 프로그램에서 사용하면 안됩니다. 


## 도메인 주도 설계 

에릭 에반스가 쓴 도메인 주도 설계는 모든 소프트웨어 엔지니어의 책장에 꽂아둬야 합니다. DDD(Domain-driven design)은 공통어휘(즉, 컨텍스트, 도메인, 모델 및 유비쿼터스 언어)를 설정하고 모델의 무결성을 유지하기 위한 원칙을 공식화 합니다. 

DDD의 가장 중요한 결과는 DDD관점에서 정의한 각 바운디드 컨텍스트가 하나의 마이크로 서비스로 매핑된다는 점입니다. DDD는 비즈니스 핵심 도메인에 집중합니다. 특히 도메인 모델을 표현, 생성, 검색하는 수단에 중점을 두고 있습니다. 

## 마이크로서비스 시대의 데이터 저장소

마이크로서비스 아키텍처가 도입되어 영속 계층에 생긴 가장 큰 변화는 서비스간에 데이터 저장소를 공유하지 않게 된것 입니다. 즉 논리적으로 분할된 각 서비스가 데이터를 소유하고 관리하는 경우, 서비스 API를 호출을 제외한 방식으로는 다른 서비스의 데이터에 접근할 수 없는 것이 이상적입니다. 

물리적으로 보면 스토리지를 서비스 마다 나눌때 다양한 방식으로 구현할 수 있습니다. 가장 간단한 방법은 하나의 데이터베이스 서버를 두고 각 서비스에 대해 독립적인 별도의 스키마(마이크로서비스마다 스키마)를 할당하는 것입니다. 이런 구성은 구현이 쉽고 서버 리소스를 적게 필요로 하며, 실제 운영환경에서 많은 관리 노력이 필요치 않아 초기 개발 단계에서 좋습니다. 

구현이 쉬운 방면에 규칙이 무너지기도 쉽습니다. 데이터가 동일한 데이터베이스에 저장되기 때문에 개발자가 둘 이상의 서비스에 겹치는 데이터를 검색하거나 변경할 수 있습니다. 

이럴때 각 서비스가 하나의 데이터베이스를 공유하지만 다른 엑세스 권한을 가져 서비스에 맞는 데이터 베이스에 엑세스 하도록 만들수 있습니다. 

심지어 요구사항에 따라 혼합해서 사용할 수도 있습니다. 
일부 서비스는 독립적인 데이터베이스 서버로 묶고 나머지는 메인 데이터 베이스 서버로 묶고 서버 안의 DB를 서비스에 맞게 만듭니다. 

심지어 다른 종류의 데이터베이스 서버를 동시에 사용하는 것도 가능하며, 다른 종류의 데이터베이스 엔진(SQL 및 NoSQL) 함께 사용해 최상의 결과를 얻을 수 있습니다. 이 접근법을 다중 저장소 영속화(polyglot persistence)라 합니다.

요즘에는 시스템이 둘 이상의 서로 다른 데이터베이스를 사용하는것이 거의 일상입니다. 

대부분의 관계형 데이터베이스는 ACID원칙을 토대로 구축되었으며 스토리지와 통신하기 위해 거의 유사한 SQL언어를 제공합니다. 일반적으로 RDBMS는 광범위한 응용 프로그램에 적합하지만, 그래프 저장, 분산 저장소에 대해선 최상의 기능을 제공하진 않습니다.  반면 NoSQL 데이터베이스는 광범위한 기본 원칙을 가져 범용 데이터 저장소로는 적합하진 않지만 몇 가지 사례에서는 좋은 성능을 보입니다. 

또한다중 언어 영속성은 복잡성으로 인해 추가 비용이 듭니다. 

스프링 데이터는 데이터 영속성을 위한 하위 프로젝트를 가지고 있습니다. 앞으로 이 스프링 데이터에서 사용할 수 있는 다양한 디자인 접근법과 데이터 베이스 커넥터에 대해서 알아봅시다. 

## 서비스로서의 데이터베이스 

적절히 설계된 마이크로서비스 아키텍처에서 모든 서비스가 상태에 의존적이지 않으며, 모든 상태 정보는 데이터 지속성을 관리하는 방법을 알고 있는 특수 서비스에 저장됩니다. 

클라우드용으로 설계되지 않은 데이터베이스 서버를 효율적으로 관리하고 조정하는 것은 꽤나 어려운 일입니다. 대부분 클라우드 제공 업체는 데이터베이스를 서비스(DBaas)로 제공해 이런 문제를 해결합니다. 이런 스토리지 솔루션은 일반 데이터베이스(MySQL, PostgreSQL 및 Redis)를 약간 수정하여 제공하거나 애초에 클라우드용으로 설계되었습니다. 

## 마이크로서비스 사이의 데이터 공유

실제 비즈니스 시스템에서는 요청을 처리하기 위해 두 개 이상의 서비스가 소유한 DB에 쿼리를 해야하는 경우가 있습니다. 마이크로 서비스 아키텍처 이전에는 이 작업을 단일 조인 쿼리로 구현했겠지만, 마이크로 서비스에서는 금지되는 방식입니다. 

그리고 데이터를 조회하는 것은 매우 간단





> Written with [StackEdit](https://stackedit.io/).
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTEwMTAxMzc0NDMsODQzNjAwNTc4LC0xMT
E2NzE0MjQ5LC04NDE4OTgyMzEsLTE1NzQ0ODk1NTUsMTU3NzQx
MjYyMCwtMTAzNzIwMjE2MSwtNTA3NzgzNDE1LDI0NDc0MzExMC
wtMTQ2NjU1MzA3MSwtOTgxNjgxNTQ5LDEyMTk4NDg5MzYsLTc3
Mzg1MDAyNiwyMTI2ODA5NTA4LDQyNTYyNzM0MF19
-->