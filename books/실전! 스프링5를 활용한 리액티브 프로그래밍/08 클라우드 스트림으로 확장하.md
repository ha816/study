# Overview

리액티브 방법은 스프링 생태계와 함께 한다면 더욱 좋습니다. 이번에는 스프링 클라우드 생태계가 제공하는 기능을 사용해 애플리케이션을 개선하는 방법과 **스프링 클라우드 스트림(Spring Cloud Stream)**을 사용해 완전한 리액티브 시스템을 구축하는 방법을 배울것 입니다. 또한 **RSocket** 라이브러리가 무엇인지 빠른 스트리밍 시스템을 개발하는데 어떻게 도움이 되는지 알아봅시다. 

#  Message Brocker 

메세지 기반 시스템의 본질은 메세지 중심의 통신에 있다는 것을 알아야 합니다. 또한 이전 장에서 리액티브 프로그래밍 기술을 적용해 프로세스 및 서비스 사이의 통신을 위한 비동기 상호 작용을 작성할 수 있습니다. 리액티브 스트림 스펙을 사용해 비동기 방식으로 배압과 오류를 관리할 수 있습니다. 

## 서버사이드 로드밸런싱

분산 시스템 개발 초기 단계에서 위치 투명성과 탄력성을 얻는 방법 중 하나는 HAProxy/Nginx와 같은 외부 로드 밸런서를 진입점으로 사용하거나 전체 시스템에 대한 중앙 로드 밸런서로 사용하는 것입니다. 

게이트 웨이의 역할은 모든 사용자의 요청을 조율하고 두 서비스 A와 B를 호출합니다. 서비스 A가 엑세스 제어의 역할을 한다고 가정합시다. 서비스 A는 호출에 포함된 엑세스 토큰이 올바른지 확인하고 해당 요청이 게이트웨이 접근할 권한이 있는지 확인합니다.

하나의 서비스 앞단에는 로드 밸런서가 존재하게 됩니다. 로드 밸런서로 오토 스케일링을 사용하려면 로드 밸런서가 해당 서비스의 전체 로드 상태를 제공해야 하고 이를 위해 커넥션 수와 같은 메트릭을 수집할 수 있어야 합니다. 또는 로드 밸런서가 응답 대기 시간을 수집하고 이를 기반으로 서비스 상태에 대한 몇 가지 추측이 가능합니다.

로드 밸런서는 주기적으로 이 정볼르 상태 정보와 결합해 로드가 감소할때는 중복 노드를 할당 해제하거나 로드가 증가하면 추가 리소스를 할당하기 위해 노력합니다. 

로드 밸런서는 마치 하위 인스턴스의 레지스트리 역할을 수행합니다. 각 서비스 그룹에는 모든 인스턴스 간의 로드를 관리하는 로드밸런서가 있습니다. 로드 밸런서는 전체 그룹 로드 및 메트릭을 기반으로 스케이링 프로세스를 시작할 수 있습니다. 

하지만 몇 가지 문제점이 있습니다. 우선 로드가 높을때, 로드 밸런서가 시스템의 핫스팟이 될 수 있습니다. 암달의 법칙에 따라 로드 밸런서가 병목 포인트가 되고 서비스 그룹의 최대 처리량이 로드 밸런서의 처리량을 넘을 수 없습니다. 

전용 로드 밸런서는 별도의 강력한 머신이나 가상 머신을 필요로 하기 때문에 로드 밸런서에 비용이 높습니다. 

### 스프링 클라우드와 Ribbong을 이용한 클라이언트 사이트 로드 밸런싱

다행스럽게도 스프링 클라우드 생태계가 서버 측 로드 밸런서가 시스템의 핫 포인트가 되는 문제를 해결하려고 합니다. 스프링 팀은 외부 로드 밸런서에 대한 해결책 대신, 넷플릭스의 분산 시스템 구축 사례를 따르기로 했습니다. 확장성 및 위치 투명성을 달성하는 방법 중 하나는 클라이언트 측 로드 밸런싱을 사용하는 것 입니다. 

클라이언트 로드 밸런싱은 간단합니다. 즉 각 서비스가 다른 서비스의 가용한 인스턴스를 확인하기 위해서 특정한 클라이언트와 통신을 시도합니다. 이를 통해 서비스간 로드 균형을 쉽게 맞추게 됩니다. 


<!--stackedit_data:
eyJoaXN0b3J5IjpbLTgzNTE4MDcxMywtMTc4OTEzOTgwOSwxNj
k1MjYyMjQsLTE1MjE5MTUsMTU1MTQyMDIwNCwxMjk3MTA0MjIs
LTEyODMzNjc5NzUsOTYyODUyMjc1XX0=
-->