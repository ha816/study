# Overview

이 장에서는 예제로 사물인터넷과 관련된 애플리케이션을 구현한다. 카프카는 기본적으로 웹사이트 로그를 취급하는 시스템으로 만들어 졌으나 사물인터넷을 구축하는 도구로도 이용할 수 있다. 사물 인터넷을 구축할때 카프카를 사용하는 범위와 특징, 활용법을 간단한 예제를 통해 설명한다.

# 사물인터넷에 필요한 시스템 특성과 카프카

사물인터넷은 추상적인 개념이지만 기몬 PC나 IA 서버 뿐만아니라 다양한 기기가 인터넷에 연결되어 서로 제어하는 상태를 표현한 추상적 개념이다. IOT에서 디바이스의 특징은 아래와 같다.

* 센서 디바이스는 PC 만큼의 파워, 저장소를 갖고 있지 않다.
* 수천 또는 수만개 이상의 디바이스가 접속한다.
* 데이터 처리 지연이 적어야 한다.

# 센서 데이터용 데이터 허브 설계

## 실현할 기능

사물인터넷용 데이터 허브에서 제공하는 기본 기능으로 센서 데이터 수신 기능이 있다. 여러 디바이스에서 나오는 세부적인 데이터를 카프카 브로커에서 수신하기 위한 구성에 대해 설명한다.

또한 센서 디바이스가 취급하는 데이터에 대해 정의한다. 앞서 설명한 바와 같이 센서 디바이스의 하드웨어 자원이 제한적이라는 특성하의 최소한의 데이터만 보낼 수 있다고 가정하면 몇초에 한번 정도로 다음 정보를 보내는 것으로 정의할 수 있다.

* 디바이스 ID
* 타임스탬프
* 센서 정보

데이터에는 최소한의 정보만 있다. 이러한 정보만으로는 하류 시스템에서 실현 가능한 데이터 활용은 제한적이다. 예를 들어 온도 센서를 호텔 객실에 배치하고 특정 객실의 온도가 일정 이상으로 올랐고 경고 메일 발송을 하는 처리를 구현해보도록 하자.

일반적으로 디바이스 마스터 정보를 별도로 관리하고 디바이스 ID로 연동하는 과정을 그 사이에 둠으로써 데이터를 처리한다. 그리고 이렇게 처리한 여러 속성 정보를 활용하여 다양한 서비스를 할 수 있다. 

스트림 처리에 활용되는 데이터에 마스터 데이터 등을 연관지어 보강하는 것을 데이터 보강(Data enrichment)이라고 하는 경우가 많아 본문이선 이런 표현을 쓰겠다.


## 센서 데이터의 수신 기능 설계

카프카에서 디바이스 데이터를 수신하는 법에 대해 생각해보자. 카프카에서 메시지 수신의 기본은 Producer API로 구현된 애플리케이션이 메시지를 보내고 브로커에서 받는것이다. 

프로듀서는 카프카의 기능 확자응ㄹ 위해 메시지 데이터 통신 외에도 브로커와의 메타 데이터 교환, 송신처 파티션 설정등을 한다. 

디바이스의 성능이 제한적이기 때문에 디바이스가 프로듀서의 역할을 하긴 어려울 것이다. 따라서 프로듀서의 역할은 데이터 허브에서 처리해야 한다.

디바이스에서 처리 비용을 최대한 줄이기 위해 


> Written with [StackEdit](https://stackedit.io/).
<!--stackedit_data:
eyJoaXN0b3J5IjpbMTMzMTM2NDMxOSwxNjU4NzM4NzUyLDE4Nz
I1MDQ0Miw2MDE3NDEwMiwtOTA4NzE4ODY5LDEyNTEzNDAyMDgs
LTg5NTAyODQyNiwxMzAzODIyNzI3LC0xNDEzNzg4OTY2LC02MD
gyMjc5NzUsNzMwOTk4MTE2XX0=
-->