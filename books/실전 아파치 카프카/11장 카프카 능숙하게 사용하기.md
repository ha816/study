# Overview

지금까지 여러 카프카 사례와 예제를 소개했다. 하지만 지금까지 이야기 말고도 중요한 내용이 몇가지 있다. 

* 컨슈머 그룹(Consumer Group)
* 오프셋 커밋(Offset Commit)
* 파티션 재비치(Partition Reassignment)
* 파티션 수 결정에 참고사항
* 복제본 수(Replication-Factor) 결정 참고사항


# 컨슈머 그룹

## 컨슈머 그룹이란?

카프카에서는 컨슈머가 카프카 클러스터에서 메세지를 얻어 처리한다. 이때 컨슈머는 컨슈머 그룹이라 불리는 **하나 이상의 컨슈머로 이루어진 그룹을 형성하여 메세지**를 얻는다. 

컨슈머 그룹은 Group ID라는 ID로 구분된다. 이 **Group ID는 KafkaConsumer를 생성할때 지정하는 옵션으로 group.id라는 파라미터로 지정**한다. 

**컨슈머 그룹은 동일한 Group ID를 가지는 컨슈머들로 형셩**된다. 참고로 특정 컨슈머는 여러 컨슈머 그룹에 속하지 않고 항상 하나의 컨슈머 그룹에 속한다. 

카프카 클러스터에서 수신할 메시지는 컨슈머 그룹안에서 어느 하나의 컨슈머가 수신한다. 바꿔말하면, 카프카 클러스터에서 수신할 메시지를 동일 컨슈머 그룹에 속한 컨슈머 사이에서 분산하여 수신한다. 

컨슈머 그룹은 하나의 데이터 처리를 여러 컨슈머에서 분산처리하기 위해 사용된다. 

## 컨슈머에서 파티션 할당

어떤 메세지를 컨슈머 그룹의 어느 컨슈머에서 수신하는가에 대한 할당은 수신할 토픽에 존재하는 파티션과 그룹 내 컨슈머를 매핑함으로써 가능하다. 

카프카 클러스터에서 다루는 메시지는 특정 토픽 중에 특정 파티션에 반드시 포함된다. 메시지는 컨슈머 그룹에서 각 파티션에 매핑되는 컨슈머가 수신하게 된다. 

컨슈머와 파티션의 매핑에서 각 파티션에 반드시 하나의 컨슈머가 매핑되어 있다. 반대로 파티션 수에 따라 하나의 컨슈머에는 동시에 여러 파티션이 할당될 수 도 있다. 

특정 파티션에 기록된 메시지는 반드시 매핑된 특정 컨슈머가 처리하도록 고정되어 있다. 따라서 메시지를 수신하는 토픽의 파티션 보다 컨슈머 쪽이 많은 경우에는 파티션이 매핑이 되지 않은 컨슈머가 발생할 수도 있다. 

각 파티션을 컨슈머 그룹 내에 있는 어떤 컨슈머에 매핑할 것인가에 대해서는 컨슈머 그룹에 새로운 컨슈머가 가입되는 경우등 필요에 따라 변경된다. 이 결정 정책은 컨슈머가 설정되어 있는 Assignor 로직을 따른다. 

|Assignor| Class  | 할당법|
|--|--|--|
|RoundRobin| RoundRobinAssignor  | 매핑할 파티션을 컨슈머에 하나씩 차례대로 매핑|
|Range| RangeAssignor  | 매핑할 파티션을 나열하고 컨슈머 수로 영역을 분할하여 할당|



> Written with [StackEdit](https://stackedit.io/).
<!--stackedit_data:
eyJoaXN0b3J5IjpbMTU5NjExOTk4NSwxMjcyNzQ0NTYwXX0=
-->