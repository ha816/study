# 데이터 파이프 라인이란?

카프카는 분산 메시징 시스템으로 다른 시스템이나 도구에서 보낸 메시지를 받아 다른 시스템이나 도구의 요청에 근거해 메시지를 전달하는 기능을 제공하고 있다. 

시스템 전체에 이르기 까지 그 시야를 넓히면 카프카는 데이터의 발생, 수집, 가공, 저장, 출력에 이르는 일련의 과정에서 도구와 시스템을 연결하는 역할을 한다. **데이터가 전달되는 경로나 처리를 위한 기반 전체를 데이터 파이프라인이**라 한다. 

웹 서버 OR 애플리케이션 서버 -> 카프카 클러스터 -> 실시간 집계 OR 장기 보존 & 분석기반

카프카가 하나 이상의 브로커로 된 카프카 클러스터, 프로듀서, 컨슈머, 카프카 클라이언트로 구성되어 있다고 소개했다. 이 중 데이터 파이프라인의 일부가 되는 것은 카프카 클러스터, 프로듀서, 컨슈머다. 이제 카프카를 구성하는 구성요소인 프로듀서와 컨슈머의 분류를 알아보자. 

# 데이터 파이프라인의 프로듀서 구성

프로듀서의 구성 패턴은 크게 두 가지로 나뉜다.

* 프로듀서가 직접 카프카에 메시지를 송신하는 패턴
* 프로듀서가 직접 카프카에 메시지를 송신하지 않고 중간에 메시지 송신 도구를 걸쳐 송신하는 패턴

## 프로듀서가 카프카에 메시지를 송신하는 패턴 

말 그대로 프로듀서가 직접 송신하는 패턴이다. 프로듀서 측에서 표준 기능으로 송신 기능을 제공하거나 그 외에 플러그인등을 이용할 수 있다. 이 경우 비교적 간단히 카프카로 데이터 파이프 라인을 구축할 수 있다. 

사실상 카프카가 이 분야의 산업상 표준이 되기도 했기 때문에 메시지 송신을 지원하는 미들웨어도 늘고 있다. 예를 들어, 병렬 분석 분산 처리의 하둡은 매트릭스 출력 기능중 하나로 카프카에 출력할 수 있다. 비슷하게 아파치 스파크는 처리결과를 카프카에 출력 할 수 있다. 

## 메시지 송신 도구를 걸쳐 송신하는 패턴

이 패턴은 프로듀서가 직접 카프카에 송신하지 않고 중간에 미들웨어에서 별개의 메시지 송신 도구를 이용하여 카프카에 메시지를 전송하는  패턴이다. 실제로 현업에서도 많이 사용되는 패턴으로 일반적인 HTTP 서버는 엑세스 로그를 카프카에 직접 송신하는 기능이 없다. 이 경우 로컬의 로그 파일을 출력한 뒤 별도의 송신도구로 카프카에 메시지를 송신한다. 

그 밖에는 MQTT 프로토콜을 이용하는 경우, MQTT 프로토콜을 따른 데이터를 카프카에 송신하기 위해 프로토콜 변환 처리를 위해 Proxy가 필요하다. 이러한 미들웨어가 출력한 데이터를 카프카로 송신하는 도구에 대표적인 것인 Kafka Connect와 Fluentd이다. 

# 데이터 파이프라인의 컨슈머 구성

프로듀서와 비슷하게 두 가지 패턴이 존재한다. 

* 미들웨어가 직접 카프카에서 메시지를 취득해 처리하는 패턴
* 미들웨어가 다른 도구를 통해 카프카에서 메시지를 취득하고 처리/보관하는 패턴

## 미들웨어가 직접 카프카에서 메시지를 취득해 처리하는 패턴

데이터를 처리하거나 기록하는 미들웨어가 카프카에서 직접 메시지를 수신하는 패턴이다. 배치 처리와 스트림 처리를 모두 대응 할 수 있지만 카프카가 스트림 데이터를 취급하기 때문에 특히 스트림 처리를 많이 볼 수 있다. 

카프카에서 직접 메시지를 취득해 처리하는 미들웨어는 스트림 처리가 가능한 Apache Flink가 대표적이다. 또한 스파크 같은 일부 미들웨어는 카프카에서 직접 데이터를 얻을 수 있으며 스트림 처리와 배치 처리를 모두 지원한다. 

## 미들웨어가 다른 도구를 통해 메시지를 취득하고 처리 및 보관하는 패턴


 

> Written with [StackEdit](https://stackedit.io/).
<!--stackedit_data:
eyJoaXN0b3J5IjpbMTI0MTU2ODgzNCwxOTM1NTM5OTk3LDE1MT
E1MDg4NzRdfQ==
-->