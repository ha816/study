# 스프링 프레임워크


## 스프링 코어(DI, AOP)

스프링 코어 중에서 가장 중요한 것은 DI(dependency injection)과 AOP(aspect oriented programming)이다.

DI의 경우, 하나의 애플리케이션을 동작하기 위해 여러개의 컴포너느를 통합해서 사용한다. 이때 의존성 주입이라는 접근방식이 큰 힘을 발휘한다. 

일반적으로 특정 컴포넌트를 사용할때 한 클래스에서 구현 클래스를 직접 생성해서 할당하면 두 클래스간의 결합도가 높아진다. 

많은 컴포넌트에 의존해야 하는 클래스가 이같은 방식으로 개발하는 건 큰 문제가 생길 수 있다. 이 결합도를 낮추는 방법으로 클래스의 외부에서 컴포넌트를 생성 한 후, 내부에 주입하여 사용가능하게 만드는 과정을 `의존성 주입` 또는 인젝션(injection)이라 한다. 그리고 이러한 의존성 주입을 자동으로 처리하는 기반을 DI 컨테이너라고 한다. 

스프링 프레임워크가 제공하는 기능 중 가장 중요한것이 바로 이 DI 컨테이너의 기능이다. 
```
ApplicationContext context = ...; //DI 컨테이너
UserService service = context.getBean(UserService.class);
...
```
이렇게 DI 컨테이너를 통해 각 컴포넌트의 인스턴스를 생성하고 통합 관리하면서 얻을 수 있는 장점은 컴포넌트간의 의존성 해결 뿐만이아니다. 어떤 컴포넌트는 싱글턴 객체로 만들어야 하고 어떤 컴포넌트는 매번 필요할때마다 새 인스턴스를 사용하도록 프로토 타입(prototype) 객체를 만들어야 한다. 이러한 인스턴스의 스코프 관리를 DI컨테이너가 대신한다. 심지어 각 인스턴스가 필요로 하는 공통 처리 코드를 외부에서 자동으로 끼워넣는 AOP 기능도 DI 컨테이너가 한다. 

### DI 개요

DI는 의존섭 주인, Ioc(Inverse of Control)이라 하는 디자인 패턴 중에 하나다.  Ioc는 인스턴스를 제어하는 주도권이 역전된다는 의미인데 컴포넌트를 구성하는 인스턴스의 생성과 의존관계를 해당 소크가 아닌 DI 컨테이너가 대신해주기 때문이다. 

DI 컨테이너에서 인스턴스를 관리하는 방식으로 하면 아래와 같은 장점이 있다. 
* 인스턴스의 스코프를 관리할 수 있다.
* 인스턴스의 생명 주기를 제어할 수 있다. 
* AOP 방식으로 공통 기능을 집어 넣을 수 있다.
* 의존하는 컴포넌트 간의 결합도를 낮추어 단위 테스트하기가 쉬워진다. 

### ApplicationContext와 Bean 정의

스프링 프레임 워크에서는 ApplicationContext가 DI 컨테이너의 역할을 한다. ApplicationContext를 생성할때 설정 클래스(configuration class)를 전달받아 생성한다. 이러한 설정 클래스를  자바 코드로 구현하는걸 자바 기반 설정 방식이라 한다. 

```
@Configuration
public class AppConfig {
	@Bean
	UserRepository userRepository(){
		return new UserRepositoryImpl();
	}
}
```

@Configuration과 @Bean 애너테이션을 사용해서 DI 컨테이너에 컴포넌트를 등록하면 애플리케이션은 DI 컨테이너에 있는 Bean을 DI 컨테이너로 부터 가져 올 수 있다. 

스프링 프레임워크에서는 DI 컨테이너에 등록하는 컴포넌트를 Bean이라고 하고, 이 빈에 대한 설정 정보를 빈 정의(Bean Definition). 도한 DI 컨테이너에서 빈을 찾아오는 행위를 룩업(look up)이라고 한다. 

룩업을 하는 방법에는 몇 가지 유형이 있다. 
```
UserService userService = context.getBean(UserService.class);
UserService userService = context.getBean("userService",UserService.class);
UserService userService = (UserService) context.getBean("userService");
```
1번 유형은 빈의 타입을 지정하는 방식으로 해당 타입의 객체가 DI 컨테이너에 하나만 있을때 사용한다. 
2번 유형은 빈의 타입과 이름을 지정하는 방식이다. 지정한 타입 객체가 DI 컨테이너에 여러게 있을때 구분하기 위해 사용한다. 
3번 유형은 빈의 이름을 지정하는 방식이다. 반환 값이 Object이기 때문에 형변환 해야 원하는 객체를 쓸 수 있다. 

빈을 설정하는 방법에도 몇가지 유형이 있다. 
|방법| 설명 |
|--|--|
|자바 기반 설정 방식(Java-based configuration)  | 자바 클래스에 @Configuration 애너테이션을, 메서드에 @Bean 애노테이션을 사용해서 빈을 정의하는 방법이다.|
|XML 기반 설정 방식(XML-based configuration)  |XML 파일을 사용하는 방법으로 <bean> 요소의 클래스 속성에 빈을 기술할 수 있다.|
|애너테이션 기반 설정 방식(annotation-based configuration) |@Componet같은 마커 애너테이션이 부여된 클래스를 탐색해서(Component Scan) DI 컨테이너에 빈을 자동으로 등록하는 방법이다. |

자바 기반, XML 기반 모두 DI 컨테이너를 만들면서 필요한 Bean을 세팅한다. 그에 반해서 애너테이션 기반은 다른방식이다. 

애너테이션 기반 설정 방식
이 방법은 DI 컨테이너에서 관리할 빈 자체에 빈을 정의하는 애너테이션을 부여한다. **이 애너테이션이 붙은 클래스를 탐색해서 DI 컨테이너에 자동으로 등록하는데 이를 컴포넌트 스캔(Component Scan)이라고 한다.** 또한 의존성 주입도 이제까지 처럼 명시적으로 설정하는 것이 아니라 **애노테이션이 붙어 있으면 DI 컨테이너가 자동으로 필요로 하는 의존 컴포넌트를 주입하며 이를 오토 와이어링(Auto Wiring)이라 한다.**

 









> Written with [StackEdit](https://stackedit.io/).
<!--stackedit_data:
eyJoaXN0b3J5IjpbMTk1ODk2MzQsLTMyODYwNTU3NSwtMzAyOT
QzMzgsLTE5NTM2ODg5MzgsMjA2NjEyMzY3NywyMTQxODM0ODgz
LC0zOTIyNzM3MzksLTM4MTYzNzE3LC0xNDQ0Njc4NjMyXX0=
-->