# JVM 이해하기

JVM은 프로그램이 실행되는 플랫폼이다. 
각 운영체제와 아키텍처용으로 만들어져 있고 운영체제와 애플리케이션 사이에 위치하면서 애플리케이션이 플랫폼에 상관없이 독립적으로 실행되도록 한다. 


## GC(Garbage Collection)

> 메모리는 어떻게 할당하는가?

new 키워드는 자바 heap영역에 메모리를 할당한다. 힙은 애플리케이션 영역에 접근할 수 있는 메모리의 영역이다. 객체를 할당할때 이용할 수 있는 메모리가 충분치 않으면 JVM은 가비지 컬렉션을 이용해 힙에서 메모리를 재사용하려고 한다. 그래도 충분한 메모리가 없으면 OutOfMemoryError가 발생하며 JVM이 종료된다. 

힙은 제네레이션이라는 몇 가지 영역으로 구분된다. 가비지 컬렉션에서 객체가 수집 대상에서 제외된다면 다른 제너레이션으로 옮겨진다. 예를 들어 older 제너레이션은 가비지 컬렉션이 자주 수집하지 않는 객체가 저장되어 있다. 이미 오랫동안 제거 되지 않았음이 증명된 것으로 가비지 컬렉터가 수집할 가능성이 낮다. 

객체가 처음 생겼을때는 Eden이라는 메모리영역에 할당된다. 그 후에 가비지 컬렉션의 수집 대상에서 제외되면 Survivor이라고 하는 메모리 영역으로 간다. 이 공간에서도 수집 대상에서 제외되는 객체는 Tenured에 옮겨진다. 이 제네레이션은 더 낮은 빈도로 가비지 컬렉터의 대상이 된다. 

마지막으로 Permanent, PermGen이라고 하는 제네레이션도 있다. 여기 속한 객체는 가비지 컬렉션에서 선택되지 않고, 일반적으로 String이나 상수 같이 JVM에서 실행되는데 필요한 불변상태가 포함된다. 자바 8에서 PermGen은 물리 메모리에 위치할 MetaSpace라는 새로운 영역으로 변경되었다. 

![JVM Memory](https://blogfiles.pstatic.net/20160722_243/nature128_1469145805726eIO2A_PNG/JVM.PNG?type=w2)
  
JVM에서 실행되는 모든 프로그램들(스레드)들은 메소드 영역과 힙 영역을 공유하게 된다.  
1) 메소드 영역은 클래스 내의 메소드에 해당하는 바이트코드와 클래스 변수 등이 저장  
2) 힙 영역은 프로그램의 실행 중에 생성된 객체를 저장  
3) 스택영역은 각각의 스레드가 수행되면서 실행하고 있는 메소드의 호출 상태를 저장하며, 여러개의 스레드가 수행되는 경우 다수개의 스택 프레임으로 구성될 수 있다.

 메소드 영역 (Method Area)
 1) 자바 프로그램을 구성하고 있는 **메소드와 클래스 변수(static으로 선언된 변수)를 저장**하기 위한 공간이다.  
2) JVM은 복수개의 스레드가 메소드를 정상적으로 사용하기 위한 동기화 기법을 제공

  

3. 힙 영역  
1) 프로그램 상에서 데이터를 저장하기 위해 동적으로(실행시간에)할당하여 쓸 수 있는 메모리 영역  
2) new 연산자를 통하여 개체를 동적으로 생성시  
3) 메소드 영역과 같이 모든 프로그램에 의해 공유되는 공간 -> 동기화 기법 이용

4)  **GC(GarbageCollection)으로 관리 되는 영역**

* Permanent Space : Class에 대한 Meta 정보를 저장하는 공간, 정보의 주소값 저장

* New Generation

- Eden : new로 생성된 모든 객체

- Survivor1(From) : Minor GC에 의해서 Eden, Survivor 2영역의 객체 중 활성화 된 객체만 이동하여 위치, Old Space로 이동되기 전의 객체만 위치

- Survivor2(To) : Minor GC에 의해서 Eden, Survivor 1영역의 객체 중 활성화된 객체만 이동하여 위치, Old Space로 이동되기 전의 객체만 위치

- Old Generation : Survivor 1, Survivor 2 영역에서 이동해온 객체만 위치,  Full GC*의 대상이 되는 객체가 위치

  

4. 스택영역(Stack area)  
1) LIFO(Last-In-First-Out)  
2) **메소드가 호출되어 실행될 때**  멤소드의 매개변수, 메소드 내에 선언된 메소드 지역변수, 번호나 값, 임시 변수 등을 저장하기 위한 공간

3) 메소드 호출시 필요로 되는 변수들을 스택에 저장하고, 메소드 실행이 끝나면 스택을 반환

**[출처]**  [(면접기출) JVM_Java Virtual Machine 메모리 구조](http://blog.naver.com/nature128/220768546595)|**작성자**  [폭풍우](http://blog.naver.com/nature128)


> Written with [StackEdit](https://stackedit.io/).
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTEzMjkxNTU0NTEsMTI3NTE0NjMzMCwxMD
Y5MzcyMDU0XX0=
-->